<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PatientMover</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <style>
        /* Estilos básicos para o modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
            padding-top: 60px;
            align-items: center;
            justify-content: center;
            display: flex;
        }

        .modal-content {
            background-color: #fff;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
        }

        .modal h2 {
            margin-top: 0;
        }

        .modal p {
            margin: 10px 0;
        }

        .modal-content p span {
            font-weight: bold;
        }

        .modal .action-buttons {
            text-align: right;
        }

        .modal .action-buttons button {
            margin: 10px 5px;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .modal .action-buttons button.accept {
            background-color: #4CAF50;
            color: white;
        }

        .modal .action-buttons button.accept:hover {
            background-color: #45a049;
        }

        .modal .action-buttons button.reject {
            background-color: #f44336;
            color: white;
        }

        .modal .action-buttons button.reject:hover {
            background-color: #e57373;
        }

        /* Estilos para a lista de transportes aceitos */
        #accepted-requests {
            margin-top: 20px;
        }

        #accepted-requests ul {
            list-style-type: none;
            padding: 0;
        }

        #accepted-requests li {
            background-color: #f9f9f9;
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        /* Estilos para a tabela de histórico */
        #history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        #history-table th, #history-table td {
            border: 1px solid #ddd;
            padding: 8px;
        }

        #history-table th {
            background-color: #f2f2f2;
            text-align: left;
        }
    </style>
</head>
<body>
    <header>
        <h1>PatientMover</h1>
    </header>
    <div class="container">
        <aside>
            <button class="tablink" onclick="openTab(event, 'Transport')"><i class="fas fa-ambulance"></i> Transporte</button>
            <button class="tablink" onclick="openTab(event, 'Incidents')"><i class="fas fa-exclamation-triangle"></i> Incidentes</button>
            <button class="tablink" onclick="openTab(event, 'History')"><i class="fas fa-history"></i> Histórico</button>
            <button class="tablink" onclick="openTab(event, 'AllRequests')"><i class="fas fa-list"></i> Todas as Solicitações</button>
        </aside>
        <main>
            <section id="Transport" class="tabcontent">
                <h2>Solicitações de Transporte</h2>
                <input type="text" id="searchRequest" onkeyup="filterRequests()" placeholder="Buscar paciente...">
                <ul id="request-list">
                    <!-- Os itens da lista são gerados dinamicamente -->
                    <li>
                        <a href="#" class="patient-info" onclick="showDetails('João Silva', 'Quarto 402', 'Sala de Exames', 65, 'Paciente com condição estável', 'Alta', '2024-05-12 14:30', 'Transporte de emergência para exames.')">Paciente: João Silva - Quarto 402</a>
                        <div class="action-buttons">
                            <button onclick="acceptRequest(this)">Aceitar</button>
                            <button onclick="updateStatus(this, 'recusado')">Recusar</button>
                        </div>
                        <span class="status">Status: <strong>Aguardando</strong></span>
                    </li>
                </ul>
                <div id="accepted-requests">
                    <h2>Transportes Aceitos</h2>
                    <ul id="accepted-list">
                        <!-- Os transportes aceitos são movidos para cá -->
                    </ul>
                </div>
            </section>
            <section id="Incidents" class="tabcontent">
                <h2>Reportar Incidente</h2>
                <form id="incident-form">
                    <label for="incidentPatient">Paciente:</label>
                    <input type="text" id="incidentPatient" name="incidentPatient" required>
                    <label for="incidentDescription">Descrição do Incidente:</label>
                    <textarea id="incidentDescription" name="incidentDescription" required></textarea>
                    <button type="submit">Reportar Incidente</button>
                </form>
            </section>
            <section id="History" class="tabcontent">
                <h2>Histórico de Transportes</h2>
                <table id="history-table">
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Paciente</th>
                            <th>Status</th>
                            <th>Detalhes</th>
                            <th>Incidente</th>
                        </tr>
                    </thead>
                    <tbody id="history-body">
                        <!-- Histórico de transportes é preenchido dinamicamente -->
                    </tbody>
                </table>
            </section>
            <section id="AllRequests" class="tabcontent">
                <h2>Todas as Solicitações</h2>
                <!-- Aqui serão exibidas todas as solicitações -->
            </section>
        </main>
    </div>
    <footer>
        <p>© 2024 Hospital Network</p>
    </footer>

    <!-- Modal -->
    <div id="detailsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>Detalhes do Transporte</h2>
            <p><span>Nome do Paciente:</span> <span id="patientName"></span></p>
            <p><span>Origem:</span> <span id="roomNumber"></span></p>
            <p><span>Destino:</span> <span id="destination"></span></p>
            <p><span>Idade:</span> <span id="age"></span></p>
            <p><span>Informações do Paciente:</span> <span id="patientInfo"></span></p>
            <p><span>Prioridade:</span> <span id="priority"></span></p>
            <p><span>Data e Hora:</span> <span id="dateTime"></span></p>
            <p><span>Detalhes do Transporte:</span> <span id="transportDetails"></span></p>
            <div class="action-buttons">
                <button class="accept" onclick="updateStatusFromModal('aceito')">Aceitar</button>
                <button class="reject" onclick="updateStatusFromModal('recusado')">Recusar</button>
            </div>
        </div>
    </div>

    <script>
        let currentRequestElement;

        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.querySelectorAll(".tabcontent");
            tabcontent.forEach(function(node) {
                node.style.display = "none";
            });
            tablinks = document.querySelectorAll(".tablink");
            tablinks.forEach(function(node) {
                node.classList.remove("active");
            });
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.classList.add("active");
        }
        
        function filterRequests() {
            var input, filter, ul, li, patientInfo, i, txtValue;
            input = document.getElementById('searchRequest');
            filter = input.value.toUpperCase();
            ul = document.getElementById("request-list");
            li = ul.getElementsByTagName('li');
            for (i = 0; i < li.length; i++) {
                patientInfo = li[i].getElementsByClassName("patient-info")[0];
                txtValue = patientInfo.textContent || patientInfo.innerText;
                if (txtValue.toUpperCase().indexOf(filter) > -1) {
                    li[i].style.display = "";
                } else {
                    li[i].style.display = "none";
                }
            }
        }

        function showDetails(patientName, roomNumber, destination, age, patientInfo, priority, dateTime, details) {
            currentRequestElement = event.currentTarget.parentNode;
            
            document.getElementById('patientName').textContent = patientName;
            document.getElementById('roomNumber').textContent = roomNumber;
            document.getElementById('destination').textContent = destination;
            document.getElementById('age').textContent = age;
            document.getElementById('patientInfo').textContent = patientInfo;
            document.getElementById('priority').textContent = priority;
            document.getElementById('dateTime').textContent = dateTime;
            document.getElementById('transportDetails').textContent = details;
            
            document.getElementById('detailsModal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('detailsModal').style.display = 'none';
        }

        function updateStatusFromModal(status) {
            if (currentRequestElement) {
                var statusElement = currentRequestElement.querySelector('.status strong');
                statusElement.textContent = status.charAt(0).toUpperCase() + status.slice(1);

                if (status === 'aceito') {
                    moveToAccepted(currentRequestElement);
                }
            }
            closeModal();
        }

        function acceptRequest(button) {
            currentRequestElement = button.parentNode.parentNode;
            updateStatusFromModal('aceito');
        }

        function moveToAccepted(requestElement) {
            var acceptedList = document.getElementById('accepted-list');
            var clone = requestElement.cloneNode(true);
            clone.querySelector('.action-buttons').remove();  // Remove os botões de ação do clone
            acceptedList.appendChild(clone);

            // Adiciona o transporte aceito ao histórico
            addToHistory(requestElement);

            requestElement.remove();
        }

        function addToHistory(requestElement) {
            var historyBody = document.getElementById('history-body');
            var clone = requestElement.cloneNode(true);
            var newRow = document.createElement('tr');

            var date = new Date().toLocaleString();
            var patient = clone.querySelector('.patient-info').textContent;
            var status = clone.querySelector('.status strong').textContent;
            var details = clone.querySelector('.patient-info').textContent;
            var incident = clone.getAttribute('data-incident') || 'Nenhum';

            newRow.innerHTML = `
                <td>${date}</td>
                <td>${patient}</td>
                <td>${status}</td>
                <td>${details}</td>
                <td>${incident}</td>
            `;

            historyBody.appendChild(newRow);
        }

        document.getElementById('incident-form').addEventListener('submit', function(event) {
            event.preventDefault();
            
            var patient = document.getElementById('incidentPatient').value;
            var description = document.getElementById('incidentDescription').value;

            var requestElement = findRequestByPatient(patient);
            if (requestElement) {
                requestElement.setAttribute('data-incident', description);
                addToHistory(requestElement);
            }
        });

        function findRequestByPatient(patientName) {
            var li = document.querySelectorAll('#request-list li, #accepted-list li');
            for (var i = 0; i < li.length; i++) {
                if (li[i].querySelector('.patient-info').textContent.includes(patientName)) {
                    return li[i];
                }
            }
            return null;
        }

        document.addEventListener('click', function(event) {
            if (event.target === document.getElementById('detailsModal')) {
                closeModal();
            }
        });
    </script>
</body>
</html>
